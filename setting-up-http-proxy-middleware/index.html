<!DOCTYPE html><html><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>設定 Http Proxy Middleware</title>
<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1036162710845309" async crossorigin="anonymous"></script>
<style>html{font-family:Microsoft JhengHei,PT Sans,Helvetica,Arial,sans-serif;font-size:16px}body{background-color:#f5f3ef;margin:0}ul{padding:0}.wrapper{margin:0 auto;max-width:820px;min-height:calc(100vh - 10px)}.nuxt,.wrapper{display:flex;flex-direction:column}.nuxt{flex:1 0 auto;padding-top:0}.footer{padding:1rem;text-align:center}a{color:#2f2f2f}a:hover{text-decoration:underline}h2 a{text-decoration:none!important}</style>
<style>.wrapper[data-v-7a5fc87d]{display:flex;flex-direction:column;margin:0 auto;max-width:820px;min-height:100vh}.nuxt[data-v-7a5fc87d]{flex:1}</style>
<style>h1[data-v-66dd7e4b]{display:inline;font-size:2rem}a[data-v-66dd7e4b]{color:#2f2f2f;text-decoration:none}.nav[data-v-66dd7e4b]{align-items:center;background-color:#fff;border-radius:8px;box-shadow:8px 10px 5px -8px #c7c7c7;display:flex;flex-direction:column;font-size:1.25rem;justify-content:center;margin:18px 18px 0;padding:8px}.nav a[data-v-66dd7e4b]{margin-left:10px;margin-right:10px}</style>
<style>.nuxt[data-v-54f11180]{background-color:#fff;border-radius:8px;margin:16px 16px 0;padding:16px}.nuxt[data-v-54f11180] ul{list-style-type:disc;margin-left:2rem}.nuxt[data-v-54f11180] img{max-width:100%}</style>
<style>a[data-v-4c5c0ce9]{text-decoration:none}.tag[data-v-4c5c0ce9]{margin-bottom:5px;margin-top:5px}.tag span[data-v-4c5c0ce9]{background-color:#f4f4f5;border-radius:6px;color:#6d6f73;margin-right:5px;padding:.2rem .5rem}.tag span[data-v-4c5c0ce9]:hover{background-color:#333;color:#fff;cursor:pointer}</style>
<style>pre code .line{display:block}</style>
<link rel="stylesheet" href="/_nuxt/TheHeader.cMULjnSx.css" crossorigin>
<link rel="stylesheet" href="/_nuxt/app.C7fvBMK8.css" crossorigin>
<link rel="preload" as="fetch" crossorigin="anonymous" href="/setting-up-http-proxy-middleware/_payload.json?f666ebb2-433c-4036-84d0-003bdcea0632">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/od6cmGqF.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BFzLMS9l.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Co5m-iRf.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DLWH-8Nd.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/kcSR4z77.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/AlR5SnX0.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/D2kV2haK.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CwQ1loB4.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DTpl7mxH.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BED19dl-.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Ces6R3kR.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BWUBZ4Wq.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/8F08hIpY.js">
<link rel="preload" as="fetch" fetchpriority="low" crossorigin="anonymous" href="/_nuxt/builds/meta/f666ebb2-433c-4036-84d0-003bdcea0632.json">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/DJF9GfT-.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/BdkTXQ1I.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/Dy3i0RHq.js">
<meta name="description" content="今天同事問我他遇到前端設定 API proxy 搞不定，於是我只好翻出好久以前自己做的紀錄來處理。">
<meta property="og:type" content="website">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<meta property="og:title" content="設定 Http Proxy Middleware">
<meta name="keywords" content>
<meta property="og:description" content="今天同事問我他遇到前端設定 API proxy 搞不定，於是我只好翻出好久以前自己做的紀錄來處理。">
<meta property="og:image" content="https://ogi.sh/wCmks9_sN?title=設定 Http Proxy Middleware&subtitle=&bg=4&time=">
<script type="module" src="/_nuxt/od6cmGqF.js" crossorigin></script><script>"use strict";(()=>{const t=window,e=document.documentElement,c=["dark","light"],n=getStorageValue("localStorage","nuxt-color-mode")||"light";let i=n==="system"?u():n;const r=e.getAttribute("data-color-mode-forced");r&&(i=r),l(i),t["__NUXT_COLOR_MODE__"]={preference:n,value:i,getColorScheme:u,addColorScheme:l,removeColorScheme:d};function l(o){const s=""+o+"-mode",a="";e.classList?e.classList.add(s):e.className+=" "+s,a&&e.setAttribute("data-"+a,o)}function d(o){const s=""+o+"-mode",a="";e.classList?e.classList.remove(s):e.className=e.className.replace(new RegExp(s,"g"),""),a&&e.removeAttribute("data-"+a)}function f(o){return t.matchMedia("(prefers-color-scheme"+o+")")}function u(){if(t.matchMedia&&f("").media!=="not all"){for(const o of c)if(f(":"+o).matches)return o}return"light"}})();function getStorageValue(t,e){switch(t){case"localStorage":return window.localStorage.getItem(e);case"sessionStorage":return window.sessionStorage.getItem(e);case"cookie":return getCookie(e);default:return null}}function getCookie(t){const c=("; "+window.document.cookie).split("; "+t+"=");if(c.length===2)return c.pop()?.split(";").shift()}</script></head><body><div id="__nuxt"><div class="wrapper" data-v-7a5fc87d><div class="nav header" data-v-7a5fc87d data-v-66dd7e4b><div data-v-66dd7e4b><h1 data-v-66dd7e4b>拉瑞的技術焦慮</h1></div><div data-v-66dd7e4b><a href="/" class="" data-v-66dd7e4b>首頁</a></div></div><div class="nuxt" data-v-54f11180><h1 data-v-54f11180>設定 Http Proxy Middleware</h1><div class="tag" data-v-54f11180 data-v-4c5c0ce9><!--[--><a href="/tags/前端" class="" data-v-4c5c0ce9><span data-v-4c5c0ce9>前端 <!--[--><!--]--></span></a><a href="/tags/筆記" class="" data-v-4c5c0ce9><span data-v-4c5c0ce9>筆記 <!--[--><!--]--></span></a><!--]--></div><p class="text-gray-500 mb-4" data-v-54f11180>發布日期：2020/11/11</p><div data-v-54f11180><p><!--[-->今天同事問我他遇到前端設定 API proxy 搞不定，於是我只好翻出好久以前自己做的紀錄來處理。<!--]--></p><p><!--[--><a href="https://www.youtube.com/?gl=TW&amp;tab=w1" rel="nofollow"><!--[-->https://www.youtube.com/?gl=TW&amp;tab=w1<!--]--></a><!--]--></p><p><!--[-->...<!--]--></p><h2 id="先貼一下標準範例"><a href="#先貼一下標準範例"><!--[-->先貼一下標準範例<!--]--></a></h2><pre class="language-javascript shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span>// javascript
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span>const express = require(&#39;express&#39;);
</span></span><span class="line" line="4"><span>const { createProxyMiddleware } = require(&#39;http-proxy-middleware&#39;);
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span>const app = express();
</span></span><span class="line" line="7"><span emptylineplaceholder="true">
</span></span><span class="line" line="8"><span>app.use(&#39;/api&#39;, createProxyMiddleware({ target: &#39;http://www.example.org&#39;, changeOrigin: true }));
</span></span><span class="line" line="9"><span>app.listen(3000);
</span></span><span class="line" line="10"><span emptylineplaceholder="true">
</span></span><span class="line" line="11"><span>// http://localhost:3000/api/foo/bar -&gt; http://www.example.org/api/foo/bar
</span></span></code><!--]--></pre><p><!--[-->從上面的程式碼可以歸納出以下步驟:<!--]--></p><ol><!--[--><li><!--[-->首先你需要起一個 node server (範例中使用 Express.js)<!--]--></li><li><!--[-->從 http-proxy-middleware 解構出 <code><!--[-->createProxyMiddleware<!--]--></code><!--]--></li><li><!--[-->對你要轉換的路由 (範例中藥轉換的路徑是 <code><!--[-->/api<!--]--></code>)，將 <code><!--[-->createProxyMiddleware<!--]--></code> 帶入一些選項之後套用到 Express 的路由上<!--]--></li><li><!--[-->對外持續監聽某一個 port，等待轉發<!--]--></li><!--]--></ol><h2 id="http-proxy-middleware-幾個常見的選項"><a href="#http-proxy-middleware-幾個常見的選項"><!--[-->http-proxy-middleware 幾個常見的選項<!--]--></a></h2><p><!--[-->target:<!--]--></p><p><!--[-->目標 host<!--]--></p><p><!--[-->changeOrigin:<!--]--></p><p><!--[-->需不需要轉來源(通常用在要跨域的情況下，所以給 true)<!--]--></p><p><!--[-->pathRewrite:<!--]--></p><p><!--[-->改寫路徑，如下的寫法，會將你 /old-path 的 request 都轉給 /new-path
&#39;^/api/old-path&#39;: &#39;/api/new-path&#39;<!--]--></p><h2 id="參考"><a href="#參考"><!--[-->參考:<!--]--></a></h2><p><!--[--><a href="https://www.npmjs.com/package/http-proxy-middleware#http-proxy-middleware-options" rel="nofollow"><!--[-->https://www.npmjs.com/package/http-proxy-middleware#http-proxy-middleware-options<!--]--></a><!--]--></p><style>html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}</style></div></div></div></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/setting-up-http-proxy-middleware/_payload.json?f666ebb2-433c-4036-84d0-003bdcea0632">[{"state":1,"once":7,"_errors":8,"serverRendered":5,"path":11,"prerenderedAt":12},["Reactive",2],{"$scolor-mode":3},{"preference":4,"value":4,"unknown":5,"forced":6},"light",true,false,["Set"],["ShallowReactive",9],{"$PO0ZRGd7KQ":10},null,"/setting-up-http-proxy-middleware",1744039164534]</script>
<script>window.__NUXT__={};window.__NUXT__.config={public:{content:{wsUrl:""},mdc:{components:{prose:true,map:{}},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}}},gtag:{id:"G-YY1ECTGSJK",config:{},tags:[],initialConsent:true,loadingStrategy:"defer",url:"https://www.googletagmanager.com/gtag/js"}},app:{baseURL:"/",buildId:"f666ebb2-433c-4036-84d0-003bdcea0632",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>